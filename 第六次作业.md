#第六次作业--噪声退化与图像复原
####姓名：林袁钰
####班级：自动化66班 
####学号：21606504138

##摘要
图像复原技术的主要目的是以预先确定的目标来改善图像。图像复原试图利用退化现象的某种先验知识来复原被退化的图像。本次实验所涉及的退化模型主要为噪声和运动退化，噪声包括高斯噪声和椒盐噪声。并且通过设计多种均值滤波器和维纳滤波器来实现图像复原。  

***
##关键词
matlab; 高斯噪声;椒盐噪声；算术均值滤波器，几何均值滤波器；谐波滤波器；逆谐波滤波器，算术均值滤波器，维纳滤波器，约束最小二乘滤波器等。    

##作业内容
###1.在测试图像上产生高斯噪声lena图-需能指定均值和方差；在测试图像lena图加入椒盐噪声（椒和盐噪声密度均是0.1）。  
* **噪声有关知识**  
*1.高斯噪声：*  
数字图像中，噪声主要来源于图像的获取和传输过称。在空间域和频率域中，由于高斯噪声在数学上的易处理性，故实验中常用这种噪声（正态噪声模型）。高斯随机变量的PDF由下式给出：  
p(z)=(1/(2*pi)^(1/2)*D0)*exp(-(z-z0)^2/2(D0)^2);  
其中，z表示灰度值，z0表示z的平均值，D0表示z的标准差。   

*2.椒盐噪声：*  
椒盐噪声的PDF有下式给出：  
p(z)=Pa; z=a;  
p(z)=Pb; z=b;
p(1)=1-Pa-Pb; 其他。  
如果b>a,则灰度级b在图像中显示为一个亮点；反之，灰度级a在图像中显示为一个暗点。若Pa，Pb为0，则脉冲噪声为单极脉冲。若二者都不为零，尤其是近似相等的时候，则脉冲噪声将类似于在图像上随机分布的胡椒和盐分微粒。 负脉冲以一个黑点（胡椒点）出现在图像中，正脉冲以白点（盐粒点）出现在图像中。

* **调用函数说明**  
**g=imnoise(f,'gaussian',m,var)**    
将均值m,方差为var的高斯噪声加到图像f上，默认值是均值m为0，方差var为0.01的噪声。
**IP=imnoise(I,'salt & pepper',0.1);**    
将椒盐噪声（椒和盐噪声密度均是0.1）加入图像。  
* **实验代码**   
实验代码在附件Noise中。  
* **实验结果**  
注：下图分别为lena原图和加入高斯噪声和椒盐噪声的图像。  
![q1-1](./photo/original.png)  
![q1-2](./photo/addNoise.png)  


###2 用多种滤波器恢复被高斯噪声和椒盐噪声污染的图像  

* **均值滤波器有关知识**  
* 
*1.算术均值滤波器：*  
这是最简单的均值滤波器。另Sxy表示中心在点（x,y）处，大小为m*n的矩形子图像窗口（领域）的一组坐标，算术均值滤波器在Sxy定义的区域中计算被污染图像g（x,y）的平均值。在点（x,y）处复原图像的值，就是简单的使用Sxy定义的区域中的像素计算出的算术均值。  
这个操作可以使用大小为m*n的一个空间滤波器来实现，滤波器模糊了结果，但降低了噪声。  
*2.几何均值滤波器：*  
使用几何均值滤波器复原一副图像由如下表达式给出：  
f(x,y)=[(连乘)g(s,t)]^(1/mn);  
其中，每个复原的像素由子图像窗口中的像素的成绩1/mn次幂给出。几何均值滤波器可实现的平滑和算术均值滤波器几乎相同，但这种处理中丢失的图像细节更少。  
*3.逆谐波均值滤波器：*  
逆谐波均值滤波器基于如下表达式产生一副复原的图像：  
f(x,y)=[(求和)(g(s,t))^(Q+1)]/[(求和)（g(s,t)^(Q)];  
其中，Q称为滤波器的阶数，这种滤波器适合减少或在实际中消除椒盐噪声的影响。当Q值为正时，该滤波器消除胡椒噪声；当Q值为负时，该滤波器消除盐粒噪声。  

* **实验代码**  
实验代码在附件filter中。    

* **实验结果**  
注：以下滤波器的模板均为5*5  
![q2-1](./photo/q2/01.png)  
![q2-2](./photo/q2/02.png)  
![q2-3](./photo/q2/03.png)  
![q2-4](./photo/q2/04.png)  
![q2-5](./photo/q2/05.png)  
![q2-6](./photo/q2/06.png)  
![q2-7](./photo/q2/07.png)  
![q2-8](./photo/q2/08.png)  

* **结果分析**  
通过调用imnoise函数分别产生了被不同均值和方差的高斯噪声污染的图像，经多次试验发现当高斯噪声均值不变时，随着方差增加，图像噪声越来越严重。当方差不变时，均值会影响整个图像的灰度值。  
分别使用算术均值滤波器和几何均值滤波器和逆谐波滤波器实现对污染图像的复原。  
对比发现，算术均值滤波器和几何均值滤波器都能平滑图像中的局部变化，虽然模糊图像，但能降低噪声，且比起椒盐噪声，算术均值滤波器和几何均值滤波器二者对于高斯噪声的消除效果更好。  二者相比，几何均值滤波器损失的图像细节更少，但对噪声的消除效果没有算术均值好。  
逆谐波均值滤波器对于消除椒盐噪声有较好的效果。但不能同时消除胡椒和盐粒这两种噪声。对比Q>0H和Q<0可发现，当Q值为正时，图像处理结果都较为亮白，说明此时滤波器消除胡椒噪声。当Q为负时，图像处理结果都较为暗黑，说明此时滤波器消除盐粒噪声。  



###3.推导维纳滤波器并实现下边要求；
####(a) 实现模糊滤波器如方程Eq. (5.6-11).
####(b) 模糊lena图像：45度方向，T=1；
####(c) 再模糊的lena图像中增加高斯噪声，均值= 0 ，方差=10 pixels 以产生模糊图像；
####(d)分别利用方程 Eq. (5.8-6)和(5.9-4)，恢复图像；并分析算法的优缺点.

* **维纳滤波器有关知识**  
维纳滤波综合退化函数和噪声统计特征进行图像复原。该方法建立在图像和噪声都是随机变量的基础上，目标是找到为污染图像的一个估计值，使他们之间的均方差误差最小。  
维纳滤波过程如下所示：  
 H(i,j)=(T/(pi*(i*a+j*b)))*sin(pi*(i*a+j*b))*exp(-sqrt(-1)*pi*(i*a+j*b));  
 G(i,j)=1*(abs(H(i,j)))^2*F(i,j)/(((abs(H(i,j)))^2+k)*H(i,j));  
许多有用的度量是以噪声和未退化图像的功率谱为基础的，其中最重要的一项就是信噪比SNR，该比值给出了携带信息的信号功率水平与噪声功率水平的度量。携带低噪声的图像有较高的SNR，携带高噪声的同一图像有较低的SNR。  


* **约束最小二乘方滤波有关知识**  
维纳滤波效果虽然很好，但存在一些困难，即要求未退化图像和噪声已知，这一般在生活中很难做到。约束最小二乘方滤波仅要求噪声方差和均值，这些参数通常可以从一副给定的退化图像中计算出来。
约束最小二乘方滤波的过程有以下表达式写出：  
 H(i,j)=(T/(pi*(i*a+j*b)))*sin(pi*(i*a+j*b))*exp(-sqrt(-1)*pi*(i*a+j*b));
 G(i,j)=[conj(H(u，v))*G(u,v)]/[(abs(H(i,j)))^2+sima*(abs(P(i,j)))^2];  

**2  实验代码：**  
实验代码在附件mohu,weina和yueshu中。  

**3 实验结果：**   

![q3-1](./photo/mohu.png)  
![q3-2](./photo/weina01.png)  
![q3-3](./photo/weina02.png)  
![q3-4](./photo/weina03.png)  
![q3-5](./photo/yueshu01.png)  
![q3-6](./photo/yueshu02.png)  


* **结果分析**  
本次实验分别通过调用matlab函数模糊图像和自己编写的函数模糊图像。发现自己编写的模糊函数模糊结果较为规律不自然，matlab函数比较像生活中会出现的运动模糊。  
在维纳滤波器设计中，用了两种方法（详见代码），即调用matlab函数和自己编写的函数。对比发现，自己编写的维纳滤波器从结果上看效果并不是很好，且噪声影响仍较大，以调用matlab函数得到的图像结果为准，发现维纳滤波能较好地恢复运动模糊退化和噪声退化，效果明显但并没有特别好。  
在约束最小二乘方滤波器的设计中发现，自己设计的虽没有matlab自带函数效果好，但也能较好地还原图像，为精准比较故仍以matlab函数为准。对比发现，约束最小二乘方滤波对图像的复原结果比维纳滤波器要好，尤其是对噪声的消除。查阅资料发现，对于高噪声和中等噪声，约束最小二乘方滤波的效果较好，但对于低噪声，两种滤波器产生基本相等的结果。  

###附录
【参考文献】  
[1]冈萨雷斯，数字图像处理第三版，北京，电子工业出版社，2011  
[2]周品，MATLAB数字图像处理，北京，清华大学出版社，2012  